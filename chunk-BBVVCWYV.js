import{c as $}from"./chunk-IRLIELDQ.js";import{$a as m,Aa as a,Ab as L,Ba as A,Ja as R,K as M,Ka as w,M as k,Ma as D,Sa as g,Ta as F,V,Va as l,W as b,Wa as u,Xa as G,Ya as j,Za as B,_a as E,a as N,ab as _,b as T,bb as x,cb as S,db as I,eb as v,fb as O,gb as U,yb as H,zb as z}from"./chunk-7ANWDPTH.js";var K={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Be=T(N({},K),{"[class.ng-submitted]":"isSubmitted"});var J=new k("",{providedIn:"root",factory:()=>W}),W="always";var ee=(()=>{class o{static \u0275fac=function(n){return new(n||o)};static \u0275mod=w({type:o});static \u0275inj=M({})}return o})();var q=(()=>{class o{static withConfig(e){return{ngModule:o,providers:[{provide:J,useValue:e.callSetDisabledState??W}]}}static \u0275fac=function(n){return new(n||o)};static \u0275mod=w({type:o});static \u0275inj=M({imports:[ee]})}return o})();var te=["canvas"],ne=["audioFile"];function ie(o,t){if(o&1&&(l(0,"span"),v(1),u()),o&2){let e=t.$implicit,n=t.index,i=_(3);F("--i",n)("--text-length",i.truncateFilename(i.selectedFileName,70).length),a(),O(" ",e," ")}}function re(o,t){if(o&1&&(j(0),D(1,ie,2,5,"span",15),B()),o&2){let e=_(2);a(),g("ngForOf",e.truncateFilename(e.selectedFileName,70).split(""))}}function oe(o,t){if(o&1){let e=E();l(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10),D(4,re,2,1,"ng-container",11),u()(),l(5,"div",12)(6,"button",13),m("click",function(){V(e);let i=_();return b(i.togglePlayPause())}),v(7),u()(),l(8,"div",14),v(9),u()()()}if(o&2){let e=_();a(),F("--progress",e.currentTime/e.duration*360+"deg"),a(3),g("ngIf",e.selectedFileName),a(2),g("disabled",!(e.audioFileRef.nativeElement.files!=null&&e.audioFileRef.nativeElement.files.length)),a(),O(" ",e.isPlaying?"\u275A\u275A":"\u25BA"," "),a(2),U(" ",e.formatTime(e.currentTime)," / ",e.formatTime(e.duration)," ")}}var Y=class o{constructor(t){this.sanitizer=t;let e=`https://open.spotify.com/embed/playlist/${this.playlistId}?utm_source=generator&theme=1&autoplay=1`;this.playlistUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e)}canvasRef;audioFileRef;ctx;audioContext;analyser;dataArray;bufferLength;audio;audioSource;isPlaying=!1;audioLoaded=!1;selectedFileName="";choseFile=!0;currentTime=0;duration=0;particlesArray=[];numberOfParticles=100;colorPalette=["#FF6B6B","#4ECDC4","#C7F464","#FFE66D","#FF9F1C"];playlistId="5W9YOseBdX1xOoLA8tppEh";circumference=2*Math.PI*90;playlistUrl;isMobile=!1;maxChars=3;twinkleCount=7;checkIfMobile(){this.isMobile=window.innerWidth<=600}truncateFilename(t,e){return t?t.length<=e?t:t.slice(0,e-3)+"...":""}onFileChange(t){let e=this.audioFileRef.nativeElement;if(e.files&&e.files.length>0){let n=e.files[0];this.selectedFileName=n.name;let i=URL.createObjectURL(n);this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.audio.src=""),this.audio=new Audio(i),this.audio.addEventListener("timeupdate",()=>this.updateProgress()),this.audio.addEventListener("loadedmetadata",()=>{this.duration=this.audio.duration}),this.audio.addEventListener("ended",()=>{this.isPlaying=!1,this.audioLoaded=!0,this.choseFile=!0,this.currentTime=0}),this.setupAudioContext(),this.audioLoaded=!0,this.choseFile=!0}}togglePlayPause(){this.audio&&(this.isPlaying?(this.choseFile=!0,this.audio.pause()):(this.choseFile=!1,this.audio.play(),this.animate()),this.isPlaying=!this.isPlaying)}updateProgress(){this.currentTime=this.audio.currentTime}seekAudio(t){let e=t.target;this.audio.currentTime=parseFloat(e.value)}formatTime(t){let e=Math.floor(t/60),n=Math.floor(t%60);return`${e}:${n<10?"0":""}${n}`}ngAfterViewInit(){this.setupCanvas(),this.checkIfMobile(),this.numberOfParticles=this.isMobile?37:100,this.initParticles(),window.addEventListener("resize",this.checkIfMobile.bind(this)),this.animate()}setupCanvas(){let t=this.canvasRef.nativeElement;this.ctx=t.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",this.resizeCanvas.bind(this))}resizeCanvas(){let t=this.canvasRef.nativeElement;t.width=window.innerWidth,t.height=window.innerHeight}setupAudioContext(){this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.audioSource=this.audioContext.createMediaElementSource(this.audio),this.audioSource.connect(this.analyser),this.analyser.connect(this.audioContext.destination)}animate(){if(requestAnimationFrame(()=>this.animate()),!this.analyser)return;this.analyser.getByteFrequencyData(this.dataArray);let t=this.canvasRef.nativeElement,e=this.ctx,n=t.width,i=t.height;e.clearRect(0,0,n,i),this.isMobile||this.drawAudioVisualizer(),this.updateParticles(this.dataArray)}drawAudioVisualizer(){let t=this.canvasRef.nativeElement,e=this.ctx,n=t.width,i=t.height,d=this.bufferLength/2,r=n/d,y=i/256,f=500;for(let s=0;s<d;s++){let c=this.dataArray[s]*y;this.dataArray[s]<f&&(c=this.dataArray[s]/f*i);let p=Math.random()*360,X=(p+120)%360,Q=(p+240)%360,C=e.createLinearGradient(0,0,0,i);C.addColorStop(0,`hsl(${p}, 100%, 50%)`),C.addColorStop(.5,`hsl(${X}, 100%, 50%)`),C.addColorStop(1,`hsl(${Q}, 100%, 50%)`),e.fillStyle=C;let h=d-1-s;e.beginPath(),e.moveTo(h*r,0),e.lineTo(h*r+r,0),e.lineTo(h*r+r/2,c),e.closePath(),e.fill(),e.beginPath(),e.moveTo(s*r,i),e.lineTo(s*r+r,i),e.lineTo(s*r+r/2,i-c),e.closePath(),e.fill(),e.beginPath(),e.moveTo(0,s*r),e.lineTo(0,s*r+r),e.lineTo(c,s*r+r/2),e.closePath(),e.fill(),e.beginPath(),e.moveTo(n,h*r),e.lineTo(n,h*r+r),e.lineTo(n-c,h*r+r/2),e.closePath(),e.fill()}}updateParticles(t){let e=this.canvasRef.nativeElement,n=this.ctx;this.particlesArray.forEach(i=>{i.update(t,this.isPlaying),i.draw(n)})}initParticles(){let t=this.canvasRef.nativeElement;this.particlesArray=[];for(let e=0;e<this.numberOfParticles;e++)this.particlesArray.push(new P(t))}ngOnDestroy(){if(this.audio){let n=this.audio.volume/20,i=setInterval(()=>{this.audio.volume-n>0?this.audio.volume-=n:(clearInterval(i),this.audio.pause(),this.audio.src="",this.audioContext&&this.audioContext.close())},50)}window.removeEventListener("resize",this.resizeCanvas.bind(this)),window.removeEventListener("resize",this.checkIfMobile.bind(this))}static \u0275fac=function(e){return new(e||o)(A($))};static \u0275cmp=R({type:o,selectors:[["app-visualizer"]],viewQuery:function(e,n){if(e&1&&(x(te,7),x(ne,7)),e&2){let i;S(i=I())&&(n.canvasRef=i.first),S(i=I())&&(n.audioFileRef=i.first)}},decls:9,vars:1,consts:[["canvas",""],["audioFile",""],[1,"upload-container"],[3,"click"],["type","file","accept","audio/*","hidden","",3,"change"],["id","audioControl"],["class","circular-wrapper",4,"ngIf"],[1,"circular-wrapper"],[1,"circular-progress"],[1,"circular-text"],[1,"rotating-text"],[4,"ngIf"],[1,"play-button"],[3,"click","disabled"],[1,"time-display"],[3,"--i","--text-length",4,"ngFor","ngForOf"]],template:function(e,n){if(e&1){let i=E();G(0,"canvas",null,0),l(2,"div",2)(3,"button",3),m("click",function(){return V(i),b(n.audioFileRef.nativeElement.click())}),v(4,"Upload music"),u(),l(5,"input",4,1),m("change",function(r){return V(i),b(n.onFileChange(r))}),u()(),l(7,"div",5),D(8,oe,10,7,"div",6),u()}e&2&&(a(8),g("ngIf",n.audioLoaded))},dependencies:[L,H,z,q],styles:["canvas[_ngcontent-%COMP%]{display:block;width:100vw;height:100vh;max-width:100%;max-height:100%;position:fixed;top:0;left:0;pointer-events:none;z-index:-1}.upload-container[_ngcontent-%COMP%]{position:absolute;top:30%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;z-index:2}.upload-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#fff;color:#000;font-size:16px;padding:10px 24px;border:none;border-radius:20px;cursor:pointer;font-weight:700;transition:.3s}.upload-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f0f0f0}#audioControl[_ngcontent-%COMP%]{position:absolute;top:55%;left:50%;transform:translate(-50%,-50%);color:#fff;text-align:center;width:480px;max-width:95vw;padding:20px;border-radius:12px;z-index:2}.circular-wrapper[_ngcontent-%COMP%]{position:relative;width:20vmin;height:20vmin;margin:0 auto 15px}.circular-progress[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;background:conic-gradient(rgb(120,120,120) var(--progress),rgba(0,0,0,0) var(--progress));display:flex;align-items:center;justify-content:center;position:relative}.circular-text[_ngcontent-%COMP%], .rotating-text[_ngcontent-%COMP%]{pointer-events:none}.circular-text[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;animation:_ngcontent-%COMP%_rotateText 12s linear infinite}.rotating-text[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;transform:rotate(0)}.rotating-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:50%;top:0;transform-origin:0 10vmin;font-size:1.5vmin;color:#fff;white-space:nowrap;transform:rotate(calc(var(--i) * 360deg / var(--text-length))) translateY(-9vmin)}@keyframes _ngcontent-%COMP%_rotateText{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.time-display[_ngcontent-%COMP%]{color:#fff;font-size:12px;position:absolute;bottom:-30px;left:50%;transform:translate(-50%)}.play-button[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.play-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;border:none;background:#fff;font-size:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.3s}.play-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f0f0f0}@media (max-width: 768px){.upload-container[_ngcontent-%COMP%]{top:18%}#audioControl[_ngcontent-%COMP%]{width:95vw;padding:12px 2vw;font-size:14px;top:60%}.rotating-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10px;transform:rotate(calc(var(--i) * 360deg / var(--text-length))) translateY(-70px)}.play-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:42px;height:42px;font-size:20px}.time-display[_ngcontent-%COMP%]{font-size:11px;bottom:-24px}}@media (max-width: 480px){.upload-container[_ngcontent-%COMP%]{top:16%}#audioControl[_ngcontent-%COMP%]{width:98vw;padding:10px 2vw;font-size:13px;top:62%}.rotating-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:9px;transform:rotate(calc(var(--i) * 360deg / var(--text-length))) translateY(-60px)}.play-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:38px;height:38px;font-size:18px}.time-display[_ngcontent-%COMP%]{font-size:10px}}@media (max-width: 360px){.upload-container[_ngcontent-%COMP%]{top:14%}#audioControl[_ngcontent-%COMP%]{font-size:12px;top:64%}.rotating-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:8px;transform:rotate(calc(var(--i) * 360deg / var(--text-length))) translateY(-50px)}.play-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:34px;height:34px;font-size:16px}.time-display[_ngcontent-%COMP%]{font-size:9px}}"]})},P=class{constructor(t){this.canvas=t;this.x=Math.random()*t.width,this.y=Math.random()*t.height,this.baseSize=Math.random()*5+2,this.size=this.baseSize,this.speedX=Math.random()*2-1,this.speedY=Math.random()*2-1,this.color=["#4ECDC4","#C7F464","#FFE66D","#FF9F1C","#FF6B6B","#1A535C","#6A4C93","#FFB5E8","#B8F2E6","#D0E6A5","#FFDAC1","#F4A261","#2A9D8F","#E76F51","#9D4EDD","#00B4D8","#F72585","#3A86FF","#8338EC","#FFD6A5","#06D6A0"][Math.floor(Math.random()*20)]}x;y;size;speedX;speedY;color;baseSize;update(t,e){let n=t[0],i=t[t.length-1],d=t[Math.floor(t.length/2)],r=Date.now()*.001,y=n/256,f=d/256,s=i/256;this.x+=this.speedX+Math.sin(this.y*.005+r*.3)*y*2+(Math.random()-.5)*f*.5,this.y+=this.speedY+Math.cos(this.x*.005-r*.2)*s*2+Math.sin(r*.3)*f*1,e?(this.x>this.canvas.width&&(this.x=0),this.x<0&&(this.x=this.canvas.width),this.y>this.canvas.height&&(this.y=0),this.y<0&&(this.y=this.canvas.height)):((this.x>this.canvas.width||this.x<0)&&(this.speedX*=-1),(this.y>this.canvas.height||this.y<0)&&(this.speedY*=-1));let c=y*3,p=s*1;this.size=this.baseSize+c-p,this.size=Math.max(this.baseSize*.5,this.size)}draw(t){t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fillStyle=this.color,t.fill()}};export{Y as VisualizerComponent};
